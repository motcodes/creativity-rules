# Dokku Static Site

TODO:

       ## WARNING: `heroku-buildpack-static` is deprecated

       This buildpack is deprecated and is no longer being maintained.
       If you are using this project, you can transition over to NGINX via an NGINX buildpack.
       Use your project's existing configuration.
       To find the NGINX configuration generated by the heroku-buildpack-static you can run:

       ```
       $ heroku run bash
       ~ $ bin/config/make-config
       ~ $ cat config/nginx.conf
       ```

       These commands will output your current NGINX config generated from your `static.json` contents.

       - Write these contents to your local repo at `config/nginx.conf.erb`, commit them to git.
       - Replace path logic that previously used `mruby` with static logic.
       - Configure your app to use the NGINX buildpack via `heroku buildpacks:add heroku-community/nginx`.
       - Remove this buildpack via `heroku buildpacks:remove heroku-community/static` (or `heroku buildpacks:remove https://github.com/heroku/heroku-buildpack-static`).

-----> Installed nginx 1.21.3 to /app/bin
       Using release configuration from last framework (Static HTML).
-----> Discovering process types
       Default types for  -> web
-----> Releasing easyshopping (dokku/easyshopping:latest)...
-----> Deploying easyshopping (dokku/easyshopping:latest)...
-----> App Procfile file found (/home/dokku/easyshopping/DOKKU_PROCFILE)
-----> DOKKU_SCALE file not found in app image. Generating one based on Procfile...
       DOKKU_SCALE declares scale -> web=1
=====> Processing deployment checks
-----> Attempting pre-flight checks (web.1)
       CHECKS expected result:
       http://localhost/ => "A Project on Dokku"
       Attempt 1/10. Waiting for 1 seconds ...
       All checks successful!
=====> easyshopping web container output:
       Starting log redirection...
       Starting nginx...
       172.17.0.1 - - [11/Jan/2023:10:42:00 +0000] "GET / HTTP/1.1" 200 890 "-" "curl/7.47.0"
=====> end easyshopping web container output
-----> Running post-deploy
-----> Configuring easyshopping.projects.multimediatechnology.at...(using built-in template)
-----> Creating http nginx.conf
-----> Setting max upload size to 2M
Reloading nginx configuration (via systemctl): nginx.service.
       Reloading nginx
-----> Renaming containers
       Renaming container (84593de70ffd) hopeful_stonebraker to easyshopping.web.1
=====> Application deployed:
       http://easyshopping.projects.multimediatechnology.at

To ssh://projects.multimediatechnology.at:5412/easyshopping
 * [new branch]      master -> master
bjelline@Macbook dokku-static-site (master)*
$ rake static[quizme]
Should work on day quizme
Objekte aufzählen: 323, fertig.
Zähle Objekte: 100% (323/323), fertig.
Delta-Kompression verwendet bis zu 4 Threads.
Komprimiere Objekte: 100% (280/280), fertig.
Schreibe Objekte: 100% (323/323), 290.69 KiB | 14.53 MiB/s, fertig.
Gesamt 323 (Delta 163), Wiederverwendet 105 (Delta 36), Pack wiederverwendet 0
-----> Cleaning up...
-----> Building quizme from herokuish...
-----> Injecting apt repositories and packages ...
-----> Adding BUILD_ENV to build environment...
-----> Multipack app detected
=====> Downloading Buildpack: https://github.com/heroku/heroku-buildpack-static
=====> Detected Framework: Static HTML
       ## WARNING: `heroku-buildpack-static` is deprecated

       This buildpack is deprecated and is no longer being maintained.
       If you are using this project, you can transition over to NGINX via an NGINX buildpack.
       Use your project's existing configuration.
       To find the NGINX configuration generated by the heroku-buildpack-static you can run:

       ```
       $ heroku run bash
       ~ $ bin/config/make-config
       ~ $ cat config/nginx.conf
       ```

       These commands will output your current NGINX config generated from your `static.json` contents.

       - Write these contents to your local repo at `config/nginx.conf.erb`, commit them to git.
       - Replace path logic that previously used `mruby` with static logic.
       - Configure your app to use the NGINX buildpack via `heroku buildpacks:add heroku-community/nginx`.
       - Remove this buildpack via `heroku buildpacks:remove heroku-community/static` (or `heroku buildpacks:remove https://github.com/heroku/heroku-buildpack-static`).



This is a reusable Docker image that allows to deploy static sites to Dokku with Dockerfile (and without using buildbacks). Runs an nginx web worker to serve your index.html site.

based on [dokku-static-site](https://github.com/shrmnk/dokku-static-site)

## Instructions

1. Clone this repo

```
git clone https://gitlab.mediacube.at/mediacube/dokku-static-site
cd dokku-static-site
```

2. Make changes to your site (by default, we have index.html and 404.html) and commit them

```
git add .
git commit -m "<Commit message>"
```

3. Add dokku host as a git remote

```
git remote add dokku dokku@<dokku.host>:<app-name>
```

4. Push to dokku

```
git push dokku master
```

